# Category Type Detection Script

Overview:
This script processes extracted product data and enriches it with a new column "type".
Classification is based on keywords defined in a YAML file (type_definitions/type.yaml).
The workflow is simple:
Input CSV (from scrapers) -> Script -> Output CSV (with extra "type" column)

Requirements:
- Python 3.10+
- Dependencies:
  PyYAML
- Install dependencies:
  pip install -r requirements.txt

How it works:
1. The script looks for the latest folder in "arhive/" that starts with "results_data_".
2. Inside it, it reads the file "output_data.csv" (generated by the scrapers).
3. It loads type definitions from "type_definitions/type.yaml".
4. For each product in output_data.csv, it checks if the product name contains any of the associated keywords.
5. If a keyword matches -> the product is assigned that type.
6. If no keywords match -> the product is assigned "Other".
7. The results are written to "output_data_with_type.csv".

Example Input (arhive/output_data.csv):
date,produkt,price
2023-09-20,Holzbrett,100
2023-09-21,Sperrmüll Container,200
2023-09-22,Laptop Dell,1200

Example type.yaml:
Bauabfälle:
  - Holz
Sperrmüll:
  - Sperrmüll
Other: []

Example Output (output_data_with_type.csv):
date,type,produkt,price
2023-09-20,Bauabfälle,Holzbrett,100
2023-09-21,Sperrmüll,Sperrmüll Container,200
2023-09-22,Other,Laptop Dell,1200

Moving keywords between TYPES:
If you move a keyword to another type, the program will reclassify products accordingly.

Example - move "Holz" from Bauabfälle to Sperrmüll:
Bauabfälle:
  # - Holz
Sperrmüll:
  - Sperrmüll
  - Holz
Other: []

Resulting Output:
date,type,produkt,price
2023-09-20,Sperrmüll,Holzbrett,100
2023-09-21,Sperrmüll,Sperrmüll Container,200
2023-09-22,Other,Laptop Dell,1200

Creating a new TYPE:
1. Add a new top-level key (the TYPE name).
2. Under it, add the associated keywords (without "#" in front).
3. Save and rerun the script.

Example:
Electronics:
  - Laptop
  - Smartphone
  - Tablet

Resulting Output:
date,type,produkt,price
2023-09-20,Bauabfälle,Holzbrett,100
2023-09-21,Sperrmüll,Sperrmüll Container,200
2023-09-22,Electronics,Laptop Dell,1200

Important Notes:
- Keyword detection is case-sensitive.
  "Holz" matches only "Holz"
  "holz" matches only "holz"
- The program always reads products from "arhive/output_data.csv".
- The output file is always "output_data_with_type.csv".

Summary:
- Type = category.
- Keywords = words associated with a category.
- You can:
  * Move keywords between types (products will follow them).
  * Create new types with new keywords.
  * Leave unmatched products in "Other".


Conclusion:
- The script always works with the input file located at:
  "arhive/results_data_xx_xx_xxxx/output_data.csv"
- To customize classification, you can either:
  * Create a new category (TYPE) with its own keywords, or
  * Modify an existing category by moving or editing keywords.

Note:
To manage or customize categories:
- Go to the folder: /data_pricing/category_parser/type_definitions
- Open the file: type.yaml
- Inside you will find commented examples that show how to define new types and keywords.
- You can uncomment those lines or add your own definitions to create or adjust categories.



# Category & Subcategory Parser

Overview:
This script extends the product classification by adding two new columns:
- category
- subcategory
The logic is based on additional YAML definition files, one per type.

File Structure:
All category definitions are stored in the folder: type_definitions/
Each type must have its own YAML file named: type_<type_name>.yml
Examples:
type_Bauabfälle.yml
type_Gartenabfälle.yml
type_Verpackungen.yml

YAML Format:
Each YAML file must follow the structure:
categories:
  - category: <Category Name>
    synonyms:
      - <Keyword 1>
      - <Keyword 2>
      - <Keyword 3>

Example type_Bauabfälle.yml:
categories:
  - category: Beton
    synonyms:
      - Beton
      - Stahlbeton
  - category: Holz
    synonyms:
      - Holz
      - Altholz
  - category: Gips
    synonyms:
      - Gips
      - Rigips

How it works:
1. Script reads "output_data_with_type.csv"
2. For each product name (produkt):
   - If a synonym matches, it assigns the corresponding category.
   - Remaining words become the subcategory.
   - If no synonym matches, category and subcategory stay empty.
3. Results are saved in "output_data_with_category.csv"

Example Input (output_data_with_type.csv):
date,type,produkt,price
2025-09-24,bauabfälle,Betonplatten groß,200
2025-09-24,bauabfälle,Altholz AⅠ–AⅢ,150
2025-09-24,bauabfälle,Rigips Bauglas,180

Example Output (output_data_with_category.csv):
date,type,produkt,price,category,subcategory
2025-09-24,bauabfälle,Betonplatten groß,200,Beton,platten groß
2025-09-24,bauabfälle,Altholz AⅠ–AⅢ,150,Holz,A1-A3
2025-09-24,bauabfälle,Rigips Bauglas,180,Gips,Bauglas

Adding New Categories:
- Edit or create a file: type_<type_name>.yml
- Add a new category with synonyms.
Example:
categories:
  - category: Glas
    synonyms:
      - Glas
      - Bauglas

Moving a Product to Another Category:
- Move its keyword (synonym) from one category to another in the YAML file.
- Example:
Before:
- category: Holz
  synonyms:
    - Altholz
After:
- category: Gips
  synonyms:
    - Altholz
Result: Products containing "Altholz" will be assigned to category=Gips

Notes:
- Keyword matching is case-insensitive.
- Subcategory = remaining words after the synonym.
- Parentheses are auto-corrected if unbalanced.
- Roman numerals (Ⅰ,Ⅱ,Ⅲ) are normalized to A1, A2, A3.

Summary:
- Each type has its own YAML file.
- Categories = main classification.
- Synonyms = trigger words.
- Subcategory = extra detail from product name.

Conclusion (Categories & Subcategories):
- The script extends classification by adding "category" and "subcategory".
- It reads definitions from files in "type_definitions/type_<name>.yml".
- Each file can define multiple categories with synonyms.
- If a product matches a synonym → it is assigned to that category, and the remaining words become the subcategory.
- To customize:
  * Create a new file "type_<name>.yml" with categories and synonyms, or
  * Edit an existing file and move/add synonyms as needed.


Note:
- For each new TYPE that you add in `type.yaml`, you must also create a file:
  `type_<newcategory>.yml`
  inside `type_definitions/`.

- The parser will only read rows from the CSV where the column "type" matches the TYPE name in the file.
  Example: if the file is `type_Bauabfälle.yml`, it will only process rows with type = "Bauabfälle".

- Each category defined in this YAML will be used as the main classification.
  * The category name will appear in the "category" column of the output.
  * All synonyms listed under that category will also map products to this same category.
  * Any remaining words from the original product name (after the synonym) will automatically become the "subcategory".

- This design ensures that the output keeps the category label, but also preserves the original product wording in the subcategory,
  so the full product context is never lost.
